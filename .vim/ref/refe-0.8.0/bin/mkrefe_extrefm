#!/Users/alpaca/.rbenv/versions/2.0.0-p247/bin/ruby -Ke
#
# mkrefe_extrefm
#
# Copyright (c) 2003 Minero Aoki <aamine@loveruby.net>
#
# This program is free software.
# you can distribute/modify this program under the terms of
# the GNU Lesser General Public License version 2 or later.
#

require 'refe/database'
require 'refe/extrefmparser'
require 'refe/mygetopt'
require 'refe/info'


getopt = MyGetoptLong.new(<<EndUsage, <<EndOptions)
Usage: mkrefe_extrefm [-d <dir>] <filename>

%%options%%

EndUsage

  o -d --databasedir  <dir>  Use <dir> as the database root directory.
  o -  --version      -      Print program version and quit.
  o -h --help         -      Print this message and quit.

EndOptions


opts = {}
begin
  getopt.each do |name, arg|
    opts[name] = arg
  end
rescue => err
  getopt.usage 1, err.message
end
getopt.usage(0) if opts['--help']
(puts "mkrefe_extrefm version #{ReFe::Version}"; exit 0) if opts['--version']


table = ReFe::Database.new(opts['--databasedir'], true).function_document
parser = ReFe::ExtentionAPIReferenceManualParser.new
ARGV.each do |fname|
  File.open(fname) {|f|
    parser.parse(f).each do |name, doc|
      table[name] = doc
    end
  }
end
table.flush
