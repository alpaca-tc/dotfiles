#!/usr/bin/env ruby

require 'open3'
require 'colorize'

def capture3(command)
  res = Open3.capture3(command)
  puts res[0] unless res[0].empty?
  puts res[1].red unless res[1].empty?
end

bin_dir = "#{`git rev-parse --show-toplevel`.strip}/bin"
spring_path = "#{bin_dir}/spring"

spring = File.file?(spring_path) ? spring_path : 'bundle exec spring'

# capture3 "#{spring} stop"
capture3 "#{spring} rake db:create"
capture3 "#{spring} rake db:migrate RAILS_ENV=development"
capture3 "#{spring} rake db:migrate RAILS_ENV=test"
